<!doctype html>
<html lang="he" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <title>FC67 ULTIMATE CHAMPIONS</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;800&display=swap');
        
        :root {
            --gold: #fcd34d;
            --gold-dark: #b45309;
            --bg: #020617;
            --card-bg: rgba(30, 41, 59, 0.85);
            --accent: #38bdf8;
            --danger: #ef4444;
            --success: #22c55e;
            --glass: rgba(255, 255, 255, 0.08);
        }

        * { box-sizing: border-box; font-family: 'Assistant', sans-serif; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        
        body { 
            margin: 0; 
            background: var(--bg); 
            background-image: radial-gradient(circle at top right, #172554, transparent), radial-gradient(circle at bottom left, #312e81, transparent);
            color: #f1f5f9; 
            padding-bottom: 90px; 
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- HEADER --- */
        .header { 
            background: rgba(2, 6, 23, 0.9);
            backdrop-filter: blur(12px);
            padding: 12px 20px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky; top: 0; z-index: 2000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .team-info h1 { margin: 0; font-size: 1.2rem; font-weight: 800; color: var(--gold); text-shadow: 0 0 15px rgba(252, 211, 77, 0.4); }
        .stats-bar { display: flex; gap: 8px; margin-top: 4px; font-size: 0.85rem; font-weight: 600; }
        .currency { background: rgba(0,0,0,0.5); padding: 4px 10px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; gap: 5px; }

        /* --- NAVIGATION --- */
        .nav-bar { 
            display: flex; 
            background: #0f172a;
            border-top: 1px solid rgba(255,255,255,0.1);
            position: fixed; bottom: 0; width: 100%; z-index: 1000;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-btn { 
            flex: 1; padding: 12px; border: none; background: none; 
            color: #64748b; font-size: 0.75rem; font-weight: 700; cursor: pointer; 
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            transition: 0.2s;
        }
        .nav-btn i { font-size: 1.2rem; margin-bottom: 2px; }
        .nav-btn.active { color: var(--gold); text-shadow: 0 0 10px rgba(252, 211, 77, 0.3); }

        /* --- TABS --- */
        .tab { display: none; padding: 15px; max-width: 600px; margin: 0 auto; animation: fadeIn 0.3s ease; }
        .tab.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- PITCH & CARDS --- */
        .pitch-container {
            background: #064e3b;
            background-image: 
                linear-gradient(rgba(255,255,255,0.1) 2px, transparent 2px),
                linear-gradient(90deg, rgba(255,255,255,0.1) 2px, transparent 2px);
            background-size: 100px 100px;
            border: 4px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 20px 0;
            position: relative;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
            margin-bottom: 20px;
        }
        
        .pitch-row { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; height: 100px; }
        
        .card-slot {
            width: 75px; height: 105px;
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; color: rgba(255,255,255,0.2); font-size: 0.9rem;
        }

        .player-card {
            width: 75px; height: 105px;
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 2px solid #475569;
            border-radius: 8px;
            position: relative;
            display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            cursor: pointer; transition: transform 0.1s;
            overflow: hidden;
        }
        .player-card:active { transform: scale(0.95); }
        
        /* Elite Card Style (88+) */
        .player-card.elite {
            border-color: var(--gold);
            background: linear-gradient(135deg, #451a03 0%, #b45309 50%, #451a03 100%);
            box-shadow: 0 0 10px rgba(252, 211, 77, 0.4);
        }
        .player-card.elite::after {
            content:''; position: absolute; top:0; left:0; right:0; bottom:0;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.2) 50%, transparent 60%);
            animation: shine 3s infinite;
        }
        @keyframes shine { 0% { transform: translateX(-100%); } 20% { transform: translateX(100%); } 100% { transform: translateX(100%); } }

        .card-rating { position: absolute; top: 2px; left: 4px; font-weight: 900; font-size: 0.9rem; color: #fff; z-index: 2; text-shadow: 1px 1px 0 #000; }
        .card-pos { position: absolute; top: 16px; left: 4px; font-size: 0.6rem; font-weight: 700; color: #cbd5e1; z-index: 2; }
        .card-img { width: 55px; height: 55px; border-radius: 50%; object-fit: cover; margin-top: 15px; border: 2px solid rgba(255,255,255,0.1); background: #000; z-index: 1;}
        .card-name { font-size: 0.65rem; text-align: center; width: 100%; white-space: nowrap; overflow: hidden; font-weight: 700; margin-top: 6px; padding: 2px; background: rgba(0,0,0,0.4); color: #fff; z-index: 2;}

        /* --- UI COMPONENTS --- */
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-weight: 800; font-size: 1rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px;}
        .btn-gold { background: linear-gradient(to bottom, #fcd34d, #f59e0b); color: #451a03; box-shadow: 0 4px 0 #b45309; }
        .btn-gold:active { transform: translateY(4px); box-shadow: none; }
        .btn-blue { background: var(--accent); color: #0f172a; box-shadow: 0 4px 0 #0284c7; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; padding-bottom: 20px; }
        
        /* --- MATCH SCREEN --- */
        #match-overlay {
            position: fixed; inset: 0; background: #020617; z-index: 5000;
            display: none; flex-direction: column; align-items: center; padding: 20px;
        }
        .scoreboard { 
            display: flex; width: 100%; justify-content: space-between; align-items: center;
            background: #1e293b; padding: 15px 25px; border-radius: 20px; margin-bottom: 20px; border: 1px solid #334155;
        }
        .score { font-size: 3rem; font-weight: 900; color: var(--gold); font-variant-numeric: tabular-nums; }
        .log-box {
            flex: 1; width: 100%; background: rgba(0,0,0,0.3); border-radius: 12px;
            overflow-y: auto; padding: 15px; font-size: 0.9rem; border: 1px solid rgba(255,255,255,0.05);
            display: flex; flex-direction: column; gap: 10px;
        }
        .log-item { padding: 8px; border-radius: 8px; background: rgba(255,255,255,0.05); animation: slideIn 0.3s; }
        .log-item.goal { background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.4); }
        .log-item.miss { background: rgba(239, 68, 68, 0.1); }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } }

        /* --- PACK OPENING --- */
        #pack-overlay {
            position: fixed; inset: 0; background: #000; z-index: 6000;
            display: none; align-items: center; justify-content: center; flex-direction: column;
        }
        .pack-wrap { width: 220px; height: 320px; perspective: 1000px; cursor: pointer; }
        .pack-inner {
            position: relative; width: 100%; height: 100%; text-align: center;
            transition: transform 0.8s; transform-style: preserve-3d;
        }
        .pack-inner.flipped { transform: rotateY(180deg); }
        .pack-front, .pack-back {
            position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden;
            border-radius: 16px; display: flex; align-items: center; justify-content: center; flex-direction: column;
        }
        .pack-front { background: linear-gradient(135deg, #b45309, #fcd34d); border: 4px solid #fff; box-shadow: 0 0 50px var(--gold); }
        .pack-back { background: transparent; transform: rotateY(180deg); }
        
        .big-card { width: 200px; height: 280px; font-size: 1.5rem; }
        .big-card .card-img { width: 100px; height: 100px; }

        /* --- LOADING --- */
        #loader { position: fixed; inset: 0; background: #020617; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .loader-spinner { width: 40px; height: 40px; border: 4px solid var(--gold); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
</head>
<body>

<div id="loader">
    <h1 style="color:var(--gold); font-size:3rem; margin-bottom: 20px;">FC67</h1>
    <div class="loader-spinner"></div>
    <p style="margin-top: 15px; color: #64748b;">××ª×—×‘×¨ ×œ×©×¨×ª×™×...</p>
</div>

<div class="header">
    <div class="team-info">
        <h1>FC67 TEAM</h1>
        <div class="stats-bar">
            <div class="currency" style="color: #a855f7;">â­ <span id="xp-display">1</span></div>
            <div class="currency" style="color: #22c55e;">âš¡ <span id="energy-display">10</span>/10</div>
        </div>
    </div>
    <div class="currency" style="background: rgba(251, 191, 36, 0.2); border-color: var(--gold); color: var(--gold); padding: 8px 15px; font-size: 1rem;">
        <span id="coins-display">0</span> ğŸ’°
    </div>
</div>

<div id="tab-club" class="tab active">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px; align-items:center;">
        <h3>×”×”×¨×›×‘ ×”×¤×•×ª×—</h3>
        <div style="background:#0f172a; padding:5px 12px; border-radius:10px; font-size:0.8rem; border:1px solid #334155;">
            ×›×™××™×”: <span id="chem-display" style="color:var(--success); font-weight:bold;">0</span>%
        </div>
    </div>

    <div class="pitch-container" id="pitch-ui">
        </div>

    <h3>×¡×¤×¡×œ ×”×§×‘×•×¦×”</h3>
    <div id="bench-ui" style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px; min-height:120px;">
        </div>

    <button class="btn btn-gold" style="margin-top: 20px; height: 60px; font-size: 1.3rem;" onclick="playMatch()">
        âš½ ×©×—×§ ××©×—×§ ×œ×™×’×” (2 âš¡)
    </button>
</div>

<div id="tab-store" class="tab">
    <h2 style="text-align:center;">×—× ×•×ª ×”×—×‘×™×œ×•×ª ğŸ›’</h2>
    <div class="grid" style="grid-template-columns: 1fr 1fr; margin-top:20px;">
        <div style="background:var(--card-bg); border:1px solid #334155; border-radius:16px; padding:15px; text-align:center; display:flex; flex-direction:column; align-items:center;">
            <div style="font-size:3rem; margin-bottom:10px;">ğŸ“¦</div>
            <h3 style="margin:0;">×—×‘×™×œ×ª ×‘×¡×™×¡</h3>
            <p style="font-size:0.8rem; color:#94a3b8;">×©×—×§× ×™× 75-85</p>
            <button class="btn btn-blue" onclick="buyPack('basic')">250 ğŸ’°</button>
        </div>
        <div style="background: linear-gradient(to bottom right, #451a03, #1e1b4b); border:1px solid var(--gold); border-radius:16px; padding:15px; text-align:center; display:flex; flex-direction:column; align-items:center;">
            <div style="font-size:3rem; margin-bottom:10px;">ğŸŒŸ</div>
            <h3 style="margin:0; color:var(--gold);">×—×‘×™×œ×ª ×–×”×‘</h3>
            <p style="font-size:0.8rem; color:#cbd5e1;">×©×—×§× ×™× 84-99</p>
            <button class="btn btn-gold" onclick="buyPack('premium')">800 ğŸ’°</button>
        </div>
    </div>
    
    <div style="background:#1e293b; border-radius:16px; padding:20px; margin-top:20px; text-align:center;">
        <h3>×‘×•× ×•×¡ ×™×•××™</h3>
        <p>×§×‘×œ ××˜×‘×¢×•×ª ×—×™× × ×‘×›×œ ×™×•×!</p>
        <button class="btn btn-blue" onclick="claimBonus()">××¡×•×£ 500 ğŸ’°</button>
    </div>
</div>

<div id="tab-collection" class="tab">
    <h3>×”××•×¡×£ ×©×œ×™ (<span id="coll-count">0</span>)</h3>
    <div id="collection-grid" class="grid"></div>
</div>

<div id="tab-social" class="tab">
    <div style="background:#1e293b; border-radius:16px; padding:20px; margin-bottom:20px; text-align:center;">
        <h2 style="color:var(--gold);">ğŸ† ×˜×‘×œ×ª ×”×× ×¦×—×™×</h2>
        <div style="text-align:right; margin-top:15px;">
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid rgba(255,255,255,0.1);">
                <span>1. ×”××œ×š1</span> <span>LVL 50</span>
            </div>
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid rgba(255,255,255,0.1);">
                <span>2. ××œ×•×£_×¢×•×œ×</span> <span>LVL 45</span>
            </div>
            <div style="display:flex; justify-content:space-between; padding:10px; background:rgba(255,255,255,0.05);">
                <span>3. ××ª×”</span> <span id="my-lvl-rank">LVL 1</span>
            </div>
        </div>
    </div>
    
    <h3>ğŸ’¬ ×¦'××˜ ×”×§×‘×•×¦×”</h3>
    <div id="chat-window" style="height:200px; background:#000; border-radius:12px; padding:10px; overflow-y:auto; border:1px solid #333;">
        <div style="font-size:0.8rem; color:#666;">×”××¢×¨×›×ª: ×‘×¨×•×š ×”×‘× ×œ×¦'××˜ FC67!</div>
    </div>
    <div style="display:flex; gap:10px; margin-top:10px;">
        <input type="text" id="chat-in" placeholder="×›×ª×•×‘ ×”×•×“×¢×”..." style="flex:1; background:#1e293b; border:none; padding:10px; border-radius:8px; color:#fff;">
        <button class="btn btn-blue" style="width:80px; margin-top:0;" onclick="sendChat()">×©×œ×—</button>
    </div>
</div>

<div class="nav-bar">
    <button class="nav-btn active" onclick="switchTab('club', this)"><span>âš½</span>××•×¢×“×•×Ÿ</button>
    <button class="nav-btn" onclick="switchTab('collection', this)"><span>ğŸ—‚ï¸</span>××•×¡×£</button>
    <button class="nav-btn" onclick="switchTab('store', this)"><span>ğŸ›’</span>×—× ×•×ª</button>
    <button class="nav-btn" onclick="switchTab('social', this)"><span>ğŸŒ</span>×§×”×™×œ×”</button>
</div>

<div id="match-overlay">
    <div style="text-align:center; margin-bottom:10px; font-weight:bold; font-size:1.2rem; color:#94a3b8;">×“×§×” <span id="match-timer">0</span></div>
    <div class="scoreboard">
        <div>
            <div style="font-size:0.8rem; color:#94a3b8;">×× ×—× ×•</div>
            <div class="score" id="score-home">0</div>
        </div>
        <div style="font-size:1.5rem; color:#475569; font-weight:800;">VS</div>
        <div>
            <div style="font-size:0.8rem; color:#94a3b8;">×™×¨×™×‘</div>
            <div class="score" id="score-away">0</div>
        </div>
    </div>
    <div class="log-box" id="match-log"></div>
    <button id="end-match-btn" class="btn btn-gold" style="display:none; margin-top:20px;" onclick="closeMatch()">×—×–×•×¨ ×œ××•×¢×“×•×Ÿ</button>
</div>

<div id="pack-overlay">
    <div class="pack-wrap" onclick="openPackAnim()">
        <div class="pack-inner" id="pack-card-inner">
            <div class="pack-front">
                <div style="font-size:4rem;">ğŸ§§</div>
                <h2>×œ×—×¥ ×œ×¤×ª×™×—×”!</h2>
            </div>
            <div class="pack-back">
                <div id="new-card-display"></div> <button class="btn btn-gold" style="position:absolute; bottom:-60px;" onclick="closePack()">×©××•×¨ ×‘××•×¢×“×•×Ÿ</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- DATABASE CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyDAyQfRIPiJO2pENF4AF9LDWTjyLeOrQNY",
        authDomain: "fc67-3de49.firebaseapp.com",
        databaseURL: "https://fc67-3de49-default-rtdb.firebaseio.com/",
        projectId: "fc67-3de49",
        storageBucket: "fc67-3de49.firebasestorage.app",
        messagingSenderId: "484648478424",
        appId: "1:484648478424:web:dfd4899b7477cc83f699ad"
    };

    // --- GAME DATA ---
    const SPECIAL_PLAYERS = [
        {name: "×›×•×©×™", pos: "FWD", rating: 99, img: "https://media.discordapp.net/attachments/1451328561226190929/1451339056314323075/31.png?ex=6945d053&is=69447ed3&hm=66d396730758c8df38e124c4776bc567ac3450a81c395b6d819989d0eb9dab25&=&format=webp&quality=lossless"},
        {name: "×”×‘×™×’×•×Ÿ", pos: "GK", rating: 91, img: "https://media.discordapp.net/attachments/1406648962458583241/1451205336177447095/WhatsApp_Image_2025-12-18_at_12.56.32_4.jpeg?ex=694553ca&is=6944024a&hm=d7bde1489a098c2b7d54403feed38fcf330e50bb43b35988c3d305ea058d1047&=&format=webp"},
        {name: "××¨", pos: "FWD", rating: 91, img: "https://media.discordapp.net/attachments/1451328561226190929/1451328868509286540/2025-12-08_140832.png?ex=6945c6d6&is=69447556&hm=780d4d9f15f33e8190e07422646c6a1412a8edee99a74c1107fba0abef3422cd&=&format=webp&quality=lossless"},
        {name: "××™×¨", pos: "GK", rating: 90, img: "https://media.discordapp.net/attachments/1406648962458583241/1451246090438443038/WhatsApp_Image_2025-12-18_at_12.56.32_9.jpeg?ex=694579be&is=6944283e&hm=dc12f06068dcbf4fcdd30f5bc9a638c9680f66e26040878e36b1c011c2580d5e&=&format=webp"},
        {name: "×©×¨×§", pos: "FWD", rating: 89, img: "https://media.discordapp.net/attachments/1406648962458583241/1451205099996053544/WhatsApp_Image_2025-12-18_at_12.56.32_2.jpeg?ex=69455391&is=69440211&hm=c6f342319b4cf7dd202ed669dd6c1bedca125616bd11d86555867a350147d586&=&format=webp"},
        {name: "×‘×•×", pos: "FWD", rating: 89, img: "https://media.discordapp.net/attachments/1406648962458583241/1451246385209938000/WhatsApp_Image_2025-12-18_at_12.56.32_10.jpeg?ex=69457a05&is=69442885&hm=2df987073db7e8828f3bf830b4090b03ea5bc72e1af70ded38a4946e1e69f189&=&format=webp"},
        {name: "×§×¨×™×¡×˜×œ", pos: "MID", rating: 89, img: "https://media.discordapp.net/attachments/1451328561226190929/1451337301178449940/71ezEUPrzPL._AC_UF8941000_QL80_.jpg?ex=6945ceb1&is=69447d31&hm=d5cc4385a9a5aa417c976669dd4329c2969580209ea4da6caf4bec1cd7b7f264&=&format=webp&width=770&height=960"},
        {name: "×•×•×™× ×™", pos: "MID", rating: 88, img: "https://media.discordapp.net/attachments/1451328561226190929/1451335757045170378/2025-12-19_001003.png?ex=6945cd40&is=69447bc0&hm=2c7fcc4d7ba2af243696f64f9d92d2d592f4878033e2d7dc3007e8ea7086157b&=&format=webp&quality=lossless"},
        {name: "×™×•× ×ª×Ÿ_×¤×“×¨×™", pos: "MID", rating: 88, img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ8vfEEelp7ot4nSWqrl3sSabqDGdiNrfHHkVjx2kqURccMwCMBbi8kSqfVHlmnTkwMgOczQgQ40RUqtIaw1sx6KVYo79keTIutrmPF9Q&s=10"},
        {name: "××•×¨", pos: "FWD", rating: 88, img: "https://media.discordapp.net/attachments/1451328561226190929/1451336872570912868/VRFS__2025-12-18_18-35-06.jpg?ex=6945ce4a&is=69447cca&hm=efd9c19eb03d8ff2faff6c6a784caa2deec7c6e4ddd58eeb9e8ca8359492ffef&=&format=webp"},
        {name: "×“×•×“", pos: "DEF", rating: 87, img: "https://media.discordapp.net/attachments/1451328561226190929/1451335794391519362/F145A669-C121-481E-B783-A929A4CD439C.png?ex=6945cd49&is=69447bc9&hm=71191ea135eac1845052f68445f1ecc4336cda64e085f43497ad56d9b9f1a7e6&=&format=webp&quality=lossless&width=640&height=960"},
        {name: "×˜×•×™", pos: "FWD", rating: 87, img: "https://media.discordapp.net/attachments/1451328561226190929/1451336172772261888/2024-07-05_180537.png?ex=6945cda4&is=69447c24&hm=476cc10a15cff4b0dccc5b9d24c65192b82a4ed518e2d18ea69f61135f5800ad&=&format=webp&quality=lossless"},
        {name: "×’×‘×™× ×”", pos: "MID", rating: 87, img: "https://media.discordapp.net/attachments/1451328561226190929/1451336082552651776/VRFS__2025-12-18_18-35-31.jpg?ex=6945cd8e&is=69447c0e&hm=b23825cfe2af008d946eea0c607562b4fd0b6377b3f4167f731e617e30a1f67c&=&format=webp"},
        {name: "×©×‘×•×ª×”", pos: "MID", rating: 86, img: "https://media.discordapp.net/attachments/1451328561226190929/1451336624318320691/2025-12-19_001354.png?ex=6945ce0f&is=69447c8f&hm=627bec49930ba5e8d88d9b6e8974327936ba5e8ed3ccd6084dc4f5420f20fbe6&=&format=webp&quality=lossless"},
        {name: "×™××™×", pos: "FWD", rating: 86, img: "https://media.discordapp.net/attachments/1406648962458583241/1451327661803831488/VRFS__2025-12-18_18-27-18.jpg?ex=6945c5b6&is=69447436&hm=7d74b821c4941f765db80ad8c1995eef2bb99784db86858d5c5932c4b3d986f0&=&format=webp"},
        {name: "×“×¨×•×¤×™×§×¡", pos: "FWD", rating: 85, img: "https://media.discordapp.net/attachments/1451328561226190929/1451335844064657531/2025-12-19_001025.png?ex=6945cd55&is=69447bd5&hm=857282b63386835b860c775eb4920a0258fade2497bc9e7924395d5071285da3&=&format=webp&quality=lossless"},
        {name: "×¢×™×œ××™", pos: "DEF", rating: 85, img: "https://media.discordapp.net/attachments/1451328561226190929/1451337583459041330/2025-04-26_211815.png?ex=6945cef4&is=69447d74&hm=df4b886341747941d96ff1071387f6869c62548219566e76653467df881324c3&=&format=webp&quality=lossless"},
        {name: "×’×•×œ×“×™", pos: "MID", rating: 84, img: "https://media.discordapp.net/attachments/1451328561226190929/1451337038656966817/gold-1920w.webp?ex=6945ce72&is=69447cf2&hm=dfc3efac8e6073074fbe6f7a19c7badf1751e8acc33b55f77aa6e3e1ab38816d&=&format=webp"},
        {name: "××§×¡×¤×¨×™×Ÿ", pos: "MID", rating: 84, img: "https://media.discordapp.net/attachments/1406648962458583241/1451326969970032650/VRFS__2025-12-18_18-37-35.jpg?ex=6945c511&is=69447391&hm=51b074b852cc68c4741c2a4ee92cd2627e01cc9f7d70e5795e17ab9ff9893e01&=&format=webp"},
        {name: "×¨×™×Ÿ", pos: "FWD", rating: 82, img: "https://www.picshare.co.il/m_pictures/img153010.jpg"},
        {name: "××™×™×¨×•×Ÿ", pos: "MID", rating: 81, img: "https://media.discordapp.net/attachments/1406648962458583241/1451327490663645375/VRFS__2025-12-18_18-34-54.jpg?ex=6945c58e&is=6944740e&hm=ee3bf9d6b88b775606e35b2da96e11ed5e4a0941ad513a4ea69ac2fd63e48ad7&=&format=webp"},
        {name: "××™×ª××¨", pos: "MID", rating: 81, img: "https://media.discordapp.net/attachments/1406648962458583241/1451327221640855643/VRFS__2025-12-18_18-27-10.jpg?ex=6945c54d&is=694473cd&hm=5f572350ff5df69a6f47299b059499482d959a853c6161f0bd00e4221f4a9903&=&format=webp"},
        {name: "×˜×œ×§×¨", pos: "DEF", rating: 80, img: "https://media.discordapp.net/attachments/1406648962458583241/1451245787190263940/WhatsApp_Image_2025-12-18_at_12.56.32_7.jpeg?ex=69457976&is=694427f6&hm=eda130bd359c11e59843bbd06c05472bb2515e1001c49bd9821a24fea6365107&=&format=webp"},
        {name: "×©×£", pos: "FWD", rating: 78, img: "https://img.haarets.co.il/bs/0000017f-e4fb-d9aa-afff-fdfb1ea10000/a0/99/0d962fda57d52105c21aa95ce50b/3983304382.jpg"},
        {name: "×‘×•×‘×•", pos: "DEF", rating: 77, img: "https://taoos.co.il/product/%D7%90%D7%99%D7%A9-%D7%A9%D7%9C%D7%92-%D7%9E%D7%97%D7%9C%D7%99%D7%A7-%D7%A2%D7%9C-%D7%A7%D7%A8%D7%97-%D7%9B%D7%95%D7%91%D7%A2-%D7%9B%D7%97%D7%95%D7%9C/"},
        {name: "××™×›××œ", pos: "MID", rating: 77, img: "https://api.dicebear.com/7.x/avataaars/svg?seed=Michael"}
    ];
    const POSITIONS = ["GK", "DEF", "MID", "FWD"];

    // --- STATE ---
    let user = {
        coins: 1000,
        energy: 10,
        xp: 0,
        lvl: 1,
        lineup: [], // Max 6
        bench: [],
        collection: []
    };
    let myId = null;
    let tempPackCard = null;

    // --- INIT ---
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    auth.signInAnonymously().catch(e => alert("Error: " + e.message));

    auth.onAuthStateChanged(u => {
        if(u) {
            myId = u.uid;
            db.ref('users/' + myId).on('value', snap => {
                const val = snap.val();
                if(val) {
                    user = val;
                    if(!user.lineup) user.lineup = [];
                    if(!user.bench) user.bench = [];
                    if(!user.collection) user.collection = [];
                } else {
                    // New user starter pack
                    for(let i=0; i<6; i++) user.collection.push(createRandomPlayer(70, 80));
                    saveUser();
                }
                updateUI();
                document.getElementById('loader').style.display = 'none';
            });
        }
    });

    function saveUser() {
        db.ref('users/' + myId).set(user);
    }

    // --- GAME LOGIC ---
    function createRandomPlayer(min, max) {
        // 15% chance for special player if in range
        if(Math.random() < 0.20) {
            const potential = SPECIAL_PLAYERS.filter(p => p.rating >= min && p.rating <= max);
            if(potential.length > 0) {
                const p = potential[Math.floor(Math.random() * potential.length)];
                return {...p, uid: Date.now() + Math.random().toString()};
            }
        }
        // Generate Generic
        const name = GENERIC_NAMES[Math.floor(Math.random() * GENERIC_NAMES.length)];
        const rating = Math.floor(Math.random() * (max - min + 1)) + min;
        const pos = POSITIONS[Math.floor(Math.random() * POSITIONS.length)];
        const img = `https://api.dicebear.com/7.x/avataaars/svg?seed=${name+rating}&backgroundColor=e5e7eb`;
        return {name, rating, pos, img, uid: Date.now() + Math.random().toString()};
    }

    function updateUI() {
        // Header
        document.getElementById('coins-display').innerText = user.coins;
        document.getElementById('energy-display').innerText = user.energy;
        document.getElementById('xp-display').innerText = user.lvl;
        document.getElementById('my-lvl-rank').innerText = "LVL " + user.lvl;

        // Lineup (4-2 Formation style visualization for 6 players: 1 GK, 2 DEF, 2 MID, 1 FWD)
        const pitch = document.getElementById('pitch-ui');
        pitch.innerHTML = '';
        
        // Define Slots
        const layout = [
            {p:'FWD', count:1},
            {p:'MID', count:2},
            {p:'DEF', count:2},
            {p:'GK', count:1}
        ];

        layout.forEach(row => {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'pitch-row';
            const rowPlayers = user.lineup.filter(p => p.pos === row.p);
            
            for(let i=0; i < row.count; i++) {
                const player = rowPlayers[i];
                if(player) {
                    rowDiv.innerHTML += renderCardHTML(player, `removeFromLineup('${player.uid}')`);
                } else {
                    rowDiv.innerHTML += `<div class="card-slot">${row.p}</div>`;
                }
            }
            pitch.appendChild(rowDiv);
        });

        // Chem logic (Simple)
        const chem = Math.floor((user.lineup.length / 6) * 100);
        document.getElementById('chem-display').innerText = chem;

        // Bench
        document.getElementById('bench-ui').innerHTML = user.bench.map(p => renderCardHTML(p, `moveToLineupFromBench('${p.uid}')`)).join('');

        // Collection
        document.getElementById('coll-count').innerText = user.collection.length;
        document.getElementById('collection-grid').innerHTML = user.collection.map((p, idx) => `
            <div style="text-align:center;">
                ${renderCardHTML(p, '')}
                <button class="btn btn-blue" style="padding:5px; font-size:0.7rem; margin-top:5px;" onclick="addToTeam(${idx})">×œ×¡×’×œ</button>
                <button class="btn btn-gold" style="padding:5px; font-size:0.7rem; margin-top:2px; background:#ef4444; color:white; box-shadow:none;" onclick="quickSell(${idx})">××›×•×¨ (${p.rating*10})</button>
            </div>
        `).join('');
    }

    function renderCardHTML(p, onclick) {
        return `
        <div class="player-card ${p.rating >= 88 ? 'elite' : ''}" onclick="${onclick}">
            <div class="card-rating">${p.rating}</div>
            <div class="card-pos">${p.pos}</div>
            <img src="${p.img}" class="card-img">
            <div class="card-name">${p.name}</div>
        </div>`;
    }

    // --- LINEUP MANAGEMENT ---
    function addToTeam(collIdx) {
        const p = user.collection[collIdx];
        
        // Constraints
        const currentInPos = user.lineup.filter(x => x.pos === p.pos).length;
        const limits = {GK:1, DEF:2, MID:2, FWD:1};

        if(currentInPos < limits[p.pos]) {
            user.lineup.push(p);
            user.collection.splice(collIdx, 1);
        } else {
            if(user.bench.length >= 7) return alert("×¡×¤×¡×œ ××œ×!");
            user.bench.push(p);
            user.collection.splice(collIdx, 1);
        }
        saveUser();
    }

    function removeFromLineup(uid) {
        const idx = user.lineup.findIndex(p => p.uid === uid);
        user.collection.push(user.lineup[idx]);
        user.lineup.splice(idx, 1);
        saveUser();
    }

    function moveToLineupFromBench(uid) {
        const idx = user.bench.findIndex(p => p.uid === uid);
        const p = user.bench[idx];
        
        const currentInPos = user.lineup.filter(x => x.pos === p.pos).length;
        const limits = {GK:1, DEF:2, MID:2, FWD:1};
        
        if(currentInPos < limits[p.pos]) {
            user.lineup.push(p);
            user.bench.splice(idx, 1);
            saveUser();
        } else {
            alert(`××™×Ÿ ××§×•× ×‘×”×¨×›×‘ ×œ-${p.pos} × ×•×¡×£`);
        }
    }

    function quickSell(idx) {
        if(!confirm("×œ××›×•×¨ ×©×—×§×Ÿ?")) return;
        const p = user.collection[idx];
        user.coins += p.rating * 10;
        user.collection.splice(idx, 1);
        saveUser();
    }

    // --- PACKS ---
    function buyPack(type) {
        const cost = type === 'basic' ? 250 : 800;
        if(user.coins < cost) return alert("××™×Ÿ ××¡×¤×™×§ ×›×¡×£!");
        
        user.coins -= cost;
        tempPackCard = type === 'basic' ? createRandomPlayer(75, 85) : createRandomPlayer(84, 99);
        
        document.getElementById('pack-overlay').style.display = 'flex';
        document.getElementById('pack-card-inner').classList.remove('flipped');
        document.getElementById('new-card-display').innerHTML = ''; // clear
    }

    function openPackAnim() {
        const inner = document.getElementById('pack-card-inner');
        if(inner.classList.contains('flipped')) return;
        
        inner.classList.add('flipped');
        
        // Render big card
        setTimeout(() => {
            const isElite = tempPackCard.rating >= 88;
            document.getElementById('new-card-display').innerHTML = `
                <div class="player-card big-card ${isElite?'elite':''}" style="margin:0 auto; width:160px; height:240px;">
                    <div class="card-rating" style="font-size:2rem;">${tempPackCard.rating}</div>
                    <div class="card-pos" style="font-size:1.2rem; top:30px;">${tempPackCard.pos}</div>
                    <img src="${tempPackCard.img}" class="card-img" style="width:100px; height:100px; margin-top:40px;">
                    <div class="card-name" style="font-size:1.5rem; margin-top:20px;">${tempPackCard.name}</div>
                </div>
                ${isElite ? '<h2 style="color:var(--gold); animation:pulse 0.5s infinite;">WALKOUT!!!</h2>' : ''}
            `;
        }, 200);
    }

    function closePack() {
        user.collection.push(tempPackCard);
        saveUser();
        document.getElementById('pack-overlay').style.display = 'none';
    }

    function claimBonus() {
        user.coins += 500;
        saveUser();
        alert("×§×™×‘×œ×ª 500 ××˜×‘×¢×•×ª!");
    }

    // --- MATCH ENGINE ---
    let matchInterval;

    function playMatch() {
        if(user.lineup.length < 6) return alert("×—×™×™×‘ 6 ×©×—×§× ×™× ×‘×”×¨×›×‘!");
        if(user.energy < 2) return alert("××™×Ÿ ×× ×¨×’×™×”!");

        user.energy -= 2;
        saveUser();

        document.getElementById('match-overlay').style.display = 'flex';
        document.getElementById('end-match-btn').style.display = 'none';
        document.getElementById('match-log').innerHTML = '';
        document.getElementById('score-home').innerText = '0';
        document.getElementById('score-away').innerText = '0';

        let time = 0;
        let homeScore = 0;
        let awayScore = 0;
        
        // Calc strength
        const myRating = user.lineup.reduce((a,b)=>a+b.rating,0) / 6;
        const oppRating = 75 + (user.lvl * 2);

        matchInterval = setInterval(() => {
            time += 3;
            document.getElementById('match-timer').innerText = time;
            
            // Events
            if(Math.random() > 0.7) {
                const isMe = Math.random() * myRating > Math.random() * oppRating;
                const logBox = document.getElementById('match-log');
                
                if(isMe) {
                    if(Math.random() > 0.4) {
                        homeScore++;
                        logBox.innerHTML = `<div class="log-item goal">âš½ ×“×§×” ${time}: ×’×•×œ×œ×œ×œ!!! ×”×§×‘×•×¦×” ×©×œ×š ××‘×§×™×¢×”!</div>` + logBox.innerHTML;
                    } else {
                        logBox.innerHTML = `<div class="log-item miss">âŒ ×“×§×” ${time}: ×”×—××¦×” ×¢× ×§×™×ª ×©×œ ×”×—×œ×•×¥ ×©×œ×š.</div>` + logBox.innerHTML;
                    }
                } else {
                    if(Math.random() > 0.4) {
                        awayScore++;
                        logBox.innerHTML = `<div class="log-item miss" style="border-color:red;">ğŸ˜° ×“×§×” ${time}: ×¡×¤×’×ª ×’×•×œ...</div>` + logBox.innerHTML;
                    } else {
                        logBox.innerHTML = `<div class="log-item">ğŸ§¤ ×“×§×” ${time}: ×”×¦×œ×” ×’×“×•×œ×” ×©×œ ×”×©×•×¢×¨ ×©×œ×š!</div>` + logBox.innerHTML;
                    }
                }
                document.getElementById('score-home').innerText = homeScore;
                document.getElementById('score-away').innerText = awayScore;
            }

            if(time >= 90) {
                clearInterval(matchInterval);
                let reward = 50;
                let xp = 10;
                let msg = "×”×¤×¡×“...";
                
                if(homeScore > awayScore) { reward = 300; xp = 50; msg = "× ×™×¦×—×•×Ÿ!"; }
                else if (homeScore === awayScore) { reward = 100; xp = 20; msg = "×ª×™×§×•."; }

                document.getElementById('match-log').innerHTML = `<h2 style="text-align:center; color:var(--gold);">${msg} (+${reward}ğŸ’°)</h2>` + document.getElementById('match-log').innerHTML;
                
                user.coins += reward;
                user.xp += xp;
                if(user.xp > user.lvl * 100) { user.lvl++; user.xp = 0; alert("×¢×œ×™×ª ×¨××”!"); }
                saveUser();
                document.getElementById('end-match-btn').style.display = 'block';
            }
        }, 150);
    }

    function closeMatch() {
        document.getElementById('match-overlay').style.display = 'none';
    }

    // --- NAVIGATION ---
    function switchTab(tabId, btn) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        btn.classList.add('active');
    }

    function sendChat() {
        const input = document.getElementById('chat-in');
        if(!input.value) return;
        const win = document.getElementById('chat-window');
        win.innerHTML += `<div><span style="color:var(--accent); font-weight:bold;">×× ×™:</span> ${input.value}</div>`;
        input.value = "";
        win.scrollTop = win.scrollHeight;
    }

</script>
</body>
</html>
